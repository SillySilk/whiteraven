{% load static %}

{% if has_images %}
<div class="menu-image-gallery" data-menu-item="{{ menu_item.id }}">
    <!-- Main Image Display -->
    <div class="main-image-container mb-3">
        {% if 'detail' in image_urls %}
            <img src="{{ image_urls.detail }}" 
                 alt="Large view of {{ menu_item.name }}" 
                 class="img-fluid rounded shadow main-image"
                 data-bs-toggle="modal" 
                 data-bs-target="#imageModal{{ menu_item.id }}"
                 style="cursor: pointer; max-height: 400px; width: 100%; object-fit: cover;">
        {% elif 'card' in image_urls %}
            <img src="{{ image_urls.card }}" 
                 alt="{{ menu_item.name }}" 
                 class="img-fluid rounded shadow main-image"
                 style="max-height: 400px; width: 100%; object-fit: cover;">
        {% else %}
            <img src="{{ image_urls.original }}" 
                 alt="{{ menu_item.name }}" 
                 class="img-fluid rounded shadow main-image"
                 style="max-height: 400px; width: 100%; object-fit: cover;">
        {% endif %}
        
        <!-- Image Overlay with Info -->
        <div class="image-overlay">
            <div class="image-info">
                {% if menu_item.has_image %}
                    <span class="badge bg-success">
                        <i class="bi bi-check-circle me-1"></i>Original Photo
                    </span>
                {% else %}
                    <span class="badge bg-warning text-dark">
                        <i class="bi bi-image me-1"></i>Placeholder
                    </span>
                {% endif %}
                
                {% if 'detail' in image_urls %}
                    <button class="btn btn-light btn-sm ms-2" 
                            data-bs-toggle="modal" 
                            data-bs-target="#imageModal{{ menu_item.id }}">
                        <i class="bi bi-arrows-fullscreen me-1"></i>Full Size
                    </button>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Thumbnail Navigation (if multiple sizes available) -->
    {% if show_thumbnails and image_urls|length > 1 %}
    <div class="thumbnail-navigation">
        <div class="row g-2">
            {% for size, url in image_urls.items %}
                {% if size != 'original' %}
                <div class="col-3">
                    <div class="thumbnail-container">
                        <img src="{{ url }}" 
                             alt="{{ menu_item.name }} - {{ size|title }}" 
                             class="img-fluid rounded thumbnail-image {% if forloop.first %}active{% endif %}"
                             data-size="{{ size }}"
                             data-url="{{ url }}"
                             style="height: 60px; width: 100%; object-fit: cover; cursor: pointer;">
                        <div class="thumbnail-label">{{ size|title }}</div>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Image Size Information -->
    <div class="image-details mt-3">
        <small class="text-muted">
            <i class="bi bi-info-circle me-1"></i>
            Available sizes: 
            {% for size in image_urls.keys %}
                <span class="badge badge-outline-secondary">{{ size|title }}</span>
                {% if not forloop.last %}, {% endif %}
            {% endfor %}
        </small>
    </div>
</div>

<!-- Full Size Image Modal -->
{% if 'detail' in image_urls %}
<div class="modal fade" id="imageModal{{ menu_item.id }}" tabindex="-1" aria-labelledby="imageModalLabel{{ menu_item.id }}" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imageModalLabel{{ menu_item.id }}">{{ menu_item.name }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img src="{{ image_urls.detail }}" 
                     alt="Full size image of {{ menu_item.name }}" 
                     class="img-fluid rounded">
            </div>
            <div class="modal-footer">
                <div class="d-flex justify-content-between w-100">
                    <div>
                        <small class="text-muted">{{ menu_item.description|truncatewords:20 }}</small>
                    </div>
                    <div>
                        <span class="badge bg-primary">{{ menu_item.display_price }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% else %}
<!-- No Image Placeholder -->
<div class="no-image-placeholder text-center py-4">
    <i class="bi bi-image display-4 text-muted mb-3"></i>
    <h6 class="text-muted">No image available</h6>
    <p class="small text-muted">Add an image to showcase this menu item</p>
</div>
{% endif %}

<style>
.menu-image-gallery {
    position: relative;
}

.main-image-container {
    position: relative;
    overflow: hidden;
    border-radius: 0.375rem;
}

.image-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.3));
    opacity: 0;
    transition: opacity 0.3s ease;
    display: flex;
    align-items: flex-end;
    padding: 1rem;
}

.main-image-container:hover .image-overlay {
    opacity: 1;
}

.thumbnail-navigation {
    margin-top: 1rem;
}

.thumbnail-container {
    position: relative;
}

.thumbnail-image {
    transition: all 0.2s ease;
    border: 2px solid transparent;
}

.thumbnail-image:hover {
    transform: scale(1.05);
    border-color: #0d6efd;
}

.thumbnail-image.active {
    border-color: #0d6efd;
    transform: scale(1.02);
}

.thumbnail-label {
    position: absolute;
    bottom: 2px;
    left: 2px;
    right: 2px;
    background: rgba(0,0,0,0.7);
    color: white;
    text-align: center;
    font-size: 0.7rem;
    padding: 2px;
    border-radius: 0 0 0.25rem 0.25rem;
}

.badge-outline-secondary {
    background-color: transparent;
    border: 1px solid #6c757d;
    color: #6c757d;
}

.no-image-placeholder {
    border: 2px dashed #dee2e6;
    border-radius: 0.375rem;
    background-color: #f8f9fa;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle thumbnail clicks
    const thumbnails = document.querySelectorAll('.thumbnail-image');
    const mainImage = document.querySelector('.main-image');
    
    thumbnails.forEach(thumb => {
        thumb.addEventListener('click', function() {
            // Remove active class from all thumbnails
            thumbnails.forEach(t => t.classList.remove('active'));
            
            // Add active class to clicked thumbnail
            this.classList.add('active');
            
            // Update main image
            if (mainImage) {
                mainImage.src = this.dataset.url;
                mainImage.alt = this.alt;
                
                // Update modal image if it exists
                const modalImage = document.querySelector('#imageModal{{ menu_item.id }} .modal-body img');
                if (modalImage) {
                    modalImage.src = this.dataset.url;
                }
            }
        });
    });
});
</script>